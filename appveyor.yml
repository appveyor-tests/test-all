environment:  
  matrix:
    
###########################
# A list of test projects, each project is described by:
#    -PROJECT_REPO
#    -PROJECT_NAME (only if differenet from PROJECT_REPO name )
#    -APPVEYOR_BUILD_WORKER_IMAGE
###########################



  - PROJECT_REPO: clone-folder-with-spaces
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
    
  - PROJECT_REPO: clone-folder-with-spaces
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015

    
clone_script:
- cmd: git clone https://github.com/appveyor-tests/%PROJECT_REPO% %APPVEYOR_BUILD_FOLDER%
- sh: git clone https://github.com/appveyor-tests/$PROJECT_REPO $APPVEYOR_BUILD_FOLDER

# if build is not built automatically
# we run build script
build_script:
- cmd: powershell .\build.ps1
- sh: bash ./build.sh

for:
################################################################
# project-specific settings not scripted in project's build.ps1
################################################################

#test project: bash-test
-
  matrix:
    only:
      - PROJECT_REPO: bash-test
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017        
  environment:
    APPVEYOR_RDP_PASSWORD: aohPass123!
  on_finish:
    - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

  
  
  
  
#test project: clone-folder-with-spaces for VS 2017
-
  matrix:
    only:
      - PROJECT_REPO: clone-folder-with-spaces
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017        

  clone_script:
  - cmd: git clone  -q --branch=master https://github.com/appveyor-tests/%PROJECT_REPO% "C:\my-projects\dir with spaces\for test project"
  - ps: cd "C:\my-projects\dir with spaces\for test project"
  - ps: ls

  skip_commits:
    message: /ubuntu-only|vs2015-only/

#test project: clone-folder-with-spaces for VS 2015
-
  matrix:
    only:
      - PROJECT_REPO: clone-folder-with-spaces
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015        

  clone_script:
  - cmd: git clone  -q --branch=master https://github.com/appveyor-tests/%PROJECT_REPO% "C:\my-projects\dir with spaces\for test project"
  - ps: cd "C:\my-projects\dir with spaces\for test project"
  - ps: ls

  skip_commits:
    message: /ubuntu-only|vs2017-only/
    
#test project: cache for VS 2017
-
  matrix:
    only:
      - PROJECT_REPO: cache
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017        

  environment:
    APPVEYOR_CACHE_ENTRY_COMPRESSION_LEVEL: Fastest

  cache:
  - packages
  - c:\test-folder\
    
  skip_commits:
    message: /ubuntu-only|vs2015-only/
    
#test project: cache for VS 2015
-
  matrix:
    only:
      - PROJECT_REPO: cache
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015        

  environment:
    APPVEYOR_CACHE_ENTRY_COMPRESSION_LEVEL: Fastest

  cache:
  - packages
  - c:\test-folder\
    
  skip_commits:
    message: /ubuntu-only|vs2017-only/
    
#test project: unit-test-runners
-
  matrix:
    only:
      - PROJECT_REPO: unit-test-runners
        PROJECT_NAME: unit-test-runners
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017        
  init:
  - ps: if (!(test-path "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community")) {Write-host ".NET Core tests require VS 2017"; Exit-AppveyorBuild}

  install:
  - nuget
  - cmd: nuget restore
  
  build:
    verbosity: minimal
    
  skip_commits:
    message: /ubuntu-only|vs2015-only/
    

#test project: unit-test-runners-except
-
  matrix:
    only:
      - PROJECT_REPO: unit-test-runners
        PROJECT_NAME: unit-test-runners-except
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017        
  environment:
    API_TOKEN:
      secure: qjR+H97oWZqZsxCoIFUY2mLZVBpq2Pf/DvnV3nXWjhA=
    APPVEYOR_BLOCK_DOTNETCORE_TESTS_AUTORUN: true
  
  install:
  - cmd: nuget restore
  
  build:
   verbosity: minimal
  
  test:
    assemblies:
      except:
      - MsTestUnitTestProject.dll
      - NUnit3TestProject.dll
      - NUnitTestProject.dll
      - XUnit20TestProject.dll
  
  after_test:
  - ps: .\checkTestsNumber.ps1 -baseUrl "https://ci.appveyor.com" -testsExpected 2
    
  skip_commits:
    message: /ubuntu-only|vs2015-only/    
    
#test project: unit-test-runners-only-old-style
-
  matrix:
    only:
      - PROJECT_REPO: unit-test-runners
        PROJECT_NAME: unit-test-runners-only-old-style
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017        
  environment:
    API_TOKEN:
      secure: qjR+H97oWZqZsxCoIFUY2mLZVBpq2Pf/DvnV3nXWjhA=
    APPVEYOR_BLOCK_DOTNETCORE_TESTS_AUTORUN: true
  
  install:
  - cmd: nuget restore
  
  build:
    verbosity: minimal

  test:
    assemblies:    
      - XUnitTestProject.dll

  after_test:
  - ps: .\checkTestsNumber.ps1 -baseUrl "https://ci.appveyor.com" -testsExpected 2
    
  skip_commits:
    message: /ubuntu-only|vs2015-only/
    
#test project: unit-test-runners-only-new-style
-
  matrix:
    only:
      - PROJECT_REPO: unit-test-runners
        PROJECT_NAME: unit-test-runners-only-new-style
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017        
  environment:
    API_TOKEN:
      secure: qjR+H97oWZqZsxCoIFUY2mLZVBpq2Pf/DvnV3nXWjhA=
    APPVEYOR_BLOCK_DOTNETCORE_TESTS_AUTORUN: true
  
  install:
  - cmd: nuget restore
  
  build:
    verbosity: minimal

  test:
    assemblies:
      only:
      - XUnitTestProject.dll
  
  after_test:
  - ps: .\checkTestsNumber.ps1 -baseUrl "https://ci.appveyor.com" -testsExpected 2
    
  skip_commits:
    message: /ubuntu-only|vs2015-only/
    
#test project: semver2-nuget-restore
-
  matrix:
    only:
      - PROJECT_REPO: semver2-nuget-restore
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017        
  before_build:
  - dotnet restore
  
  build:
    verbosity: minimal
  
  skip_commits:
    message: /ubuntu-only|vs2015-only/
    
#test project: SetupProject2017 # Appveyor test project name: wix-in-vs2017
-
  matrix:
    only:
      - PROJECT_REPO: SetupProject2017
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017 
  build:
    verbosity: minimal
  
  test: off
  
  skip_commits:
    message: /ubuntu-only|vs2015-only/

#test project: dotnetcore-nuget-pack for VS-2017
-
  matrix:
    only:
      - PROJECT_REPO: dotnetcore-nuget-pack
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017       
  version: 44.55.{build}
    
  assembly_info:
    patch: true
    file: '**\AssemblyInfo.*'
    assembly_version: '{version}'
    assembly_file_version: '{version}'
    assembly_informational_version: '{version}'
  
  dotnet_csproj:
    patch: true
    file: '**\*.csproj'
    version: '{version}'
    package_version: '{version}'
  
  before_build:
  - cmd: dotnet restore
  
  build:
    publish_nuget: true
    publish_nuget_symbols: true
    include_nuget_references: true
    verbosity: minimal
  
  test: off
  
  deploy_script:
  - ps: .\deploy.ps1
  
  skip_commits:
    message: /ubuntu-only|vs2015-only/
    

#test project: WDK-10.0.14393.0
-
  matrix:
    only:
      - PROJECT_REPO: WDK-10.0.14393.0
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
  install:
  - ps: .\install.ps1
  
  skip_commits:
    message: /ubuntu-only|vs2017-only/

#test project: artifacts

#Visual Studio 2017
-
  matrix:
    only:
      - PROJECT_REPO: artifacts
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
  artifacts:
  - path: go17.zip
  - path: go17-2-link.zip
  - path: go16
  
  on_failure:
  - ps: Get-EventLog AppVeyor -newest 10 | Format-List
  
  skip_commits:
    message: /ubuntu-only|vs2015-only/
    
#Visual Studio 2015
-
  matrix:
    only:
      - PROJECT_REPO: artifacts
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
  artifacts:
  - path: go17.zip
  - path: go17-2-link.zip
  - path: go16
  
  on_failure:
  - ps: Get-EventLog AppVeyor -newest 10 | Format-List
  
  skip_commits:
    message: /ubuntu-only|vs2017-only/
    
#test project: android-app-test VS 2015
-
  matrix:
    only:
      - PROJECT_REPO: android-app-test
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015 
  build:
    verbosity: minimal
  
  test: off
  
  skip_commits:
    message: /ubuntu-only|vs2017-only/
    
#test project: android-app-test VS 2017
-
  matrix:
    only:
      - PROJECT_REPO: android-app-test
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017 
  build:
    verbosity: minimal
  
  test: off
  
  skip_commits:
    message: /ubuntu-only|vs2015-only/

#test project: AzureCloudServiceVS2017
-
  matrix:
    only:
      - PROJECT_REPO: AzureCloudServiceVS2017
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017 
  before_build:
  - nuget restore
  
  build:
    verbosity: minimal
  
  test: off
  
  skip_commits:
    message: /ubuntu-only|vs2015-only/

#test project: azure-cloud-services VS2017 with cashing packages
-
  matrix:
    only:
      - PROJECT_REPO: azure-cloud-services
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017 
  before_build:
  - nuget restore

  cache:
  - packages

  build:
    verbosity: minimal
    publish_wap: true
    publish_azure: true
  
  skip_commits:
    message: /ubuntu-only|vs2015-only/
    
 #test project: azure-cloud-services VS2015 with cashing packages
-
  matrix:
    only:
      - PROJECT_REPO: azure-cloud-services
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015 
  before_build:
  - nuget restore

  cache:
  - packages

  build:
    verbosity: minimal
    publish_wap: true
    publish_azure: true
  
  skip_commits:
    message: /ubuntu-only|vs2017-only/
 
 #test project azure-unc-smb-share VS2017
-
  matrix:
    only:
      - PROJECT_REPO: azure-unc-smb-share
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
  environment:
    AZURE_SMB_KEY:
      secure: if71+kDyW4wl7Xbfgzi5G0Faau1OcfdfT/KU9LK+9Cmjv/DINmssTw/bfsqvDfie4RiDUsy/zMCOiSxQZ9IkiHVgx9lrkfZ1/ysDn50qwvklCKJhTjhS+UQQ8cJPrZ9q
  
  skip_commits:
    message: /ubuntu-only|vs2015-only/

 #test project azure-unc-smb-share VS2015
-
  matrix:
    only:
      - PROJECT_REPO: azure-unc-smb-share
        APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
  environment:
    AZURE_SMB_KEY:
      secure: if71+kDyW4wl7Xbfgzi5G0Faau1OcfdfT/KU9LK+9Cmjv/DINmssTw/bfsqvDfie4RiDUsy/zMCOiSxQZ9IkiHVgx9lrkfZ1/ysDn50qwvklCKJhTjhS+UQQ8cJPrZ9q
  
  skip_commits:
    message: /ubuntu-only|vs2017-only/
##########################################################################
#    global filters through skip_commits mechanism
##########################################################################
-
  matrix:
    only:
      - APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
  skip_commits:
    message: /vs2017-only|vs2015-only/

-
  matrix:
    only:
      - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
  skip_commits:
    message: /ubuntu-only|vs2015-only/
    
-
  matrix:
    only:
      - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
  skip_commits:
    message: /ubuntu-only|vs2017-only/
    

